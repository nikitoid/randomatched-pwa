// https://nuxt.com/docs/api/configuration/nuxt-config
import { defineNuxtConfig } from "nuxt/config";

export default defineNuxtConfig({
  compatibilityDate: "2025-07-15",
  devtools: { enabled: true },
  ssr: false,
  modules: ["@nuxt/ui", "@vite-pwa/nuxt"],
  css: ["~/assets/css/main.css"],
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PWA
  pwa: {
    // üì¶ –ú–∞–Ω–∏—Ñ–µ—Å—Ç ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –º–∏–Ω–∏–º—É–º
    manifest: {
      name: "Randomatched",
      short_name: "RM App",
      description: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–≥—Ä—ã Unmatched",
      theme_color: "#ffffff",
      background_color: "#ffffff",
      display: "standalone",
      start_url: "/",
      lang: "ru",
      icons: [
        { src: "/icons/icon-192.png", sizes: "192x192", type: "image/png" },
        {
          src: "/icons/icon-512.png",
          sizes: "512x512",
          type: "image/png",
          purpose: "maskable",
        },
      ],
      shortcuts: [
        {
          name: "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å",
          url: "/",
          description: "–ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è",
          icons: [
            {
              src: "/icons/icon-96.png",
              sizes: "96x96",
              type: "image/png",
            },
          ],
        },
      ],
    },

    // ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä–∞
    workbox: {
      // üì¶ –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
      globPatterns: [
        "**/*.{js,css,html,json,ico,png,jpg,jpeg,gif,svg,webp,woff,woff2,ttf,eot}",
      ],

      // üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è SPA
      navigateFallback: "/",
      navigateFallbackDenylist: [/^\/_/, /\/[^/?]+\.[^/]+$/],

      // üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ runtime –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
      runtimeCaching: [
        // –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è - NetworkFirst
        {
          urlPattern: /^\/$/,
          handler: "NetworkFirst",
          options: {
            cacheName: "pages-cache",
            expiration: {
              maxEntries: 10,
              maxAgeSeconds: 24 * 60 * 60, // 1 –¥–µ–Ω—å
            },
            networkTimeoutSeconds: 3,
          },
        },
        // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) - CacheFirst
        {
          urlPattern: /\.(?:png|jpg|jpeg|gif|svg|webp|ico)$/,
          handler: "CacheFirst",
          options: {
            cacheName: "images-cache",
            expiration: {
              maxEntries: 100,
              maxAgeSeconds: 30 * 24 * 60 * 60, // 30 –¥–Ω–µ–π
            },
          },
        },
        // CSS –∏ JS —Ñ–∞–π–ª—ã - CacheFirst
        {
          urlPattern: /\.(?:css|js)$/,
          handler: "CacheFirst",
          options: {
            cacheName: "static-resources-cache",
            expiration: {
              maxEntries: 50,
              maxAgeSeconds: 7 * 24 * 60 * 60, // 7 –¥–Ω–µ–π
            },
          },
        },
        // –®—Ä–∏—Ñ—Ç—ã - CacheFirst
        {
          urlPattern: /\.(?:woff|woff2|ttf|eot)$/,
          handler: "CacheFirst",
          options: {
            cacheName: "fonts-cache",
            expiration: {
              maxEntries: 20,
              maxAgeSeconds: 365 * 24 * 60 * 60, // 1 –≥–æ–¥
            },
          },
        },
        // API –∑–∞–ø—Ä–æ—Å—ã - StaleWhileRevalidate
        {
          urlPattern: /^https:\/\/api\./,
          handler: "StaleWhileRevalidate",
          options: {
            cacheName: "api-cache",
            expiration: {
              maxEntries: 50,
              maxAgeSeconds: 5 * 60, // 5 –º–∏–Ω—É—Ç
            },
          },
        },
      ],
    },

    // üîî –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π prompt —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    registerType: "autoUpdate",
    injectRegister: "auto",

    // üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    strategies: "generateSW",
    devOptions: {
      enabled: true,
      type: "module",
    },

    // üì± –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç—ã
    client: {
      installPrompt: true,
      periodicSyncForUpdates: 20,
    },
    includeAssets: ["favicon.ico", "icons/*.png", "manifest.webmanifest"],
  },

  // üåê –î–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –º–æ–±–∏–ª—å–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
  app: {
    head: {
      meta: [
        { charset: "utf-8" },
        { name: "viewport", content: "width=device-width, initial-scale=1" },
        { name: "description", content: "–ú–æ–µ PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" },
      ],
      link: [
        { rel: "icon", type: "image/x-icon", href: "/favicon.ico" },
        { rel: "manifest", href: "/manifest.webmanifest" },
      ],
    },
  },
});
